{% extends "base.html" %}

{% block title %}All Flashcards - BrainDeck{% endblock %}
{% block breadcrumb %}{% if current_deck %}{{ current_deck.name }}{% else %}All Cards{% endif %}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto flex flex-col gap-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight mb-2">
                {% if current_deck %}{{ current_deck.name }}{% else %}All Flashcards{% endif %}
            </h1>
            <p class="text-text-secondary">
                {% if current_deck %}{{ current_deck.description or 'Manage flashcards in this deck.' }}{% else %}View
                and manage all your flashcards.{% endif %}
            </p>
        </div>
        <div class="flex items-center gap-3">
            <a href="{{ url_for('ai.generate') }}"
                class="flex items-center justify-center gap-2 h-10 px-4 rounded-lg bg-surface-dark border border-primary/30 text-primary hover:bg-primary/10 transition-colors text-sm font-bold">
                <span class="material-symbols-outlined text-lg fill">auto_awesome</span>
                <span>AI Generate</span>
            </a>
            <a href="{{ url_for('flashcards.create_flashcard') }}"
                class="flex items-center justify-center gap-2 h-10 px-4 rounded-lg btn-primary text-sm font-bold shadow-lg shadow-primary/20">
                <span class="material-symbols-outlined text-lg">add</span>
                <span>Add Card</span>
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap items-center gap-4 py-4 border-b border-border-dark">
        <div class="flex items-center gap-2">
            <label class="text-sm text-text-secondary">Deck:</label>
            <form method="GET" action="{{ url_for('flashcards.list_flashcards') }}" id="deck-filter">
                <select name="deck_id" onchange="this.form.submit()"
                    class="rounded-lg bg-surface-highlight border-none text-white text-sm py-2 px-3 focus:ring-2 focus:ring-primary">
                    <option value="">All Decks</option>
                    {% for deck in decks %}
                    <option value="{{ deck.id }}" {% if current_deck and current_deck.id==deck.id %}selected{% endif %}>
                        {{ deck.name }}
                    </option>
                    {% endfor %}
                </select>
            </form>
        </div>
        {% if current_deck %}
        <a href="{{ url_for('study.study_session') }}?deck_id={{ current_deck.id }}"
            class="ml-auto btn-secondary px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
            <span class="material-symbols-outlined text-lg">play_arrow</span>
            Study This Deck
        </a>
        {% endif %}
    </div>

    <!-- Flashcards Grid -->
    {% if flashcards %}
    <div class="text-sm text-text-secondary mb-2">{{ flashcards|length }} card{{ 's' if flashcards|length != 1 else ''
        }}</div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for card in flashcards %}
        <div
            class="bg-surface-card rounded-xl border border-border-dark p-5 hover:border-primary/50 transition-all card-hover group">
            <div class="flex justify-between items-start mb-3">
                <span class="text-xs font-bold text-primary uppercase tracking-wider bg-primary/10 px-2 py-1 rounded">
                    {% if card.deck %}{{ card.deck.name[:15] }}...{% else %}Uncategorized{% endif %}
                </span>
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <a href="{{ url_for('flashcards.edit_flashcard', id=card.id) }}"
                        class="p-1.5 rounded hover:bg-surface-highlight text-text-secondary hover:text-white transition-colors">
                        <span class="material-symbols-outlined text-lg">edit</span>
                    </a>
                    <form action="{{ url_for('flashcards.delete_flashcard', id=card.id) }}" method="POST" class="inline"
                        onsubmit="return confirm('Delete this flashcard?');">
                        <button type="submit"
                            class="p-1.5 rounded hover:bg-surface-highlight text-text-secondary hover:text-red-400 transition-colors">
                            <span class="material-symbols-outlined text-lg">delete</span>
                        </button>
                    </form>
                </div>
            </div>

            <div class="mb-4">
                <h4 class="text-xs font-bold text-text-secondary uppercase mb-1">Question</h4>
                <p class="text-white font-medium line-clamp-3">{{ card.question }}</p>
            </div>

            <div class="pt-3 border-t border-dashed border-border-dark">
                <h4 class="text-xs font-bold text-text-secondary uppercase mb-1">Answer</h4>
                <p class="text-sm text-slate-300 line-clamp-2">{{ card.answer }}</p>
            </div>

            <div
                class="flex items-center justify-between mt-4 pt-3 border-t border-border-dark text-xs text-text-secondary">
                <span>Difficulty: {{ card.difficulty }}/5</span>
                <span>Reviewed: {{ card.times_reviewed }}x</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="bg-surface-card rounded-xl border border-border-dark p-16 text-center">
        <div class="w-20 h-20 rounded-full bg-surface-highlight flex items-center justify-center mx-auto mb-6">
            <span class="material-symbols-outlined text-4xl text-text-secondary">style</span>
        </div>
        <h3 class="text-white font-bold text-xl mb-3">No flashcards yet</h3>
        <p class="text-text-secondary mb-8 max-w-md mx-auto">
            {% if current_deck %}
            This deck is empty. Add flashcards manually or generate them with AI.
            {% else %}
            Start by creating flashcards manually or let AI generate them from your notes.
            {% endif %}
        </p>
        <div class="flex justify-center gap-4">
            <a href="{{ url_for('flashcards.create_flashcard') }}"
                class="btn-secondary px-5 py-2.5 rounded-lg font-medium">
                Create Manually
            </a>
            <a href="{{ url_for('ai.generate') }}"
                class="btn-primary px-5 py-2.5 rounded-lg font-medium flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">auto_awesome</span>
                Generate with AI
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}